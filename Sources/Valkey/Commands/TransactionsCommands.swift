//===----------------------------------------------------------------------===//
//
// This source file is part of the swift-valkey open source project
//
// Copyright (c) 2025 the swift-valkey project authors
// Licensed under Apache License v2.0
//
// See LICENSE.txt for license information
// See CONTRIBUTORS.txt for the list of swift-valkey project authors
//
// SPDX-License-Identifier: Apache-2.0
//
//===----------------------------------------------------------------------===//

// This file is autogenerated by ValkeyCommandsBuilder

import NIOCore

#if canImport(FoundationEssentials)
import FoundationEssentials
#else
import Foundation
#endif

/// Discards a transaction.
public struct DISCARD: RESPCommand {
    public typealias Response = RESPToken


    @inlinable public init() {
    }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("DISCARD")
    }
}

/// Executes all commands in a transaction.
public struct EXEC: RESPCommand {
    public typealias Response = [RESPToken]?


    @inlinable public init() {
    }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("EXEC")
    }
}

/// Starts a transaction.
public struct MULTI: RESPCommand {
    public typealias Response = RESPToken


    @inlinable public init() {
    }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("MULTI")
    }
}

/// Forgets about watched keys of a transaction.
public struct UNWATCH: RESPCommand {
    public typealias Response = RESPToken


    @inlinable public init() {
    }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("UNWATCH")
    }
}

/// Monitors changes to keys to determine the execution of a transaction.
public struct WATCH: RESPCommand {
    public typealias Response = RESPToken

    public var key: [RESPKey]

    @inlinable public init(key: [RESPKey]) {
        self.key = key
    }

    public var keysAffected: [RESPKey] { key }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("WATCH", key)
    }
}


extension ValkeyConnection {
    /// Discards a transaction.
    ///
    /// - Documentation: [DISCARD](https:/valkey.io/commands/discard)
    /// - Version: 2.0.0
    /// - Complexity: O(N), when N is the number of queued commands
    /// - Categories: @fast, @transaction
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func discard() async throws -> RESPToken {
        try await send(command: DISCARD())
    }

    /// Executes all commands in a transaction.
    ///
    /// - Documentation: [EXEC](https:/valkey.io/commands/exec)
    /// - Version: 1.2.0
    /// - Complexity: Depends on commands in the transaction
    /// - Categories: @slow, @transaction
    /// - Returns: One of the following:
    ///     * [Array](https:/valkey.io/topics/protocol/#arrays): each element being the reply to each of the commands in the atomic transaction.
    ///     * [Null](https:/valkey.io/topics/protocol/#nulls): the transaction was aborted because a `WATCH`ed key was touched.
    @inlinable
    public func exec() async throws -> [RESPToken]? {
        try await send(command: EXEC())
    }

    /// Starts a transaction.
    ///
    /// - Documentation: [MULTI](https:/valkey.io/commands/multi)
    /// - Version: 1.2.0
    /// - Complexity: O(1)
    /// - Categories: @fast, @transaction
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func multi() async throws -> RESPToken {
        try await send(command: MULTI())
    }

    /// Forgets about watched keys of a transaction.
    ///
    /// - Documentation: [UNWATCH](https:/valkey.io/commands/unwatch)
    /// - Version: 2.2.0
    /// - Complexity: O(1)
    /// - Categories: @fast, @transaction
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func unwatch() async throws -> RESPToken {
        try await send(command: UNWATCH())
    }

    /// Monitors changes to keys to determine the execution of a transaction.
    ///
    /// - Documentation: [WATCH](https:/valkey.io/commands/watch)
    /// - Version: 2.2.0
    /// - Complexity: O(1) for every key.
    /// - Categories: @fast, @transaction
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func watch(key: [RESPKey]) async throws -> RESPToken {
        try await send(command: WATCH(key: key))
    }

}
