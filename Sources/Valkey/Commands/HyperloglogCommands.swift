//===----------------------------------------------------------------------===//
//
// This source file is part of the swift-valkey open source project
//
// Copyright (c) 2025 the swift-valkey project authors
// Licensed under Apache License v2.0
//
// See LICENSE.txt for license information
// See CONTRIBUTORS.txt for the list of swift-valkey project authors
//
// SPDX-License-Identifier: Apache-2.0
//
//===----------------------------------------------------------------------===//

// This file is autogenerated by ValkeyCommandsBuilder

import NIOCore

#if canImport(FoundationEssentials)
import FoundationEssentials
#else
import Foundation
#endif

/// Adds elements to a HyperLogLog key. Creates the key if it doesn't exist.
public struct PFADD: RESPCommand {
    public typealias Response = Int

    public var key: RESPKey
    public var element: [String] = []

    @inlinable public init(key: RESPKey, element: [String] = []) {
        self.key = key
        self.element = element
    }

    public var keysAffected: CollectionOfOne<RESPKey> { .init(key) }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("PFADD", key, element)
    }
}

/// Returns the approximated cardinality of the set(s) observed by the HyperLogLog key(s).
public struct PFCOUNT: RESPCommand {
    public typealias Response = Int

    public var key: [RESPKey]

    @inlinable public init(key: [RESPKey]) {
        self.key = key
    }

    public var keysAffected: [RESPKey] { key }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("PFCOUNT", key)
    }
}

/// Merges one or more HyperLogLog values into a single key.
public struct PFMERGE: RESPCommand {
    public var destkey: RESPKey
    public var sourcekey: [RESPKey] = []

    @inlinable public init(destkey: RESPKey, sourcekey: [RESPKey] = []) {
        self.destkey = destkey
        self.sourcekey = sourcekey
    }

    public var keysAffected: [RESPKey] { [destkey] + sourcekey }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("PFMERGE", destkey, sourcekey)
    }
}

/// An internal command for testing HyperLogLog values.
public struct PFSELFTEST: RESPCommand {
    @inlinable public init() {
    }

    @inlinable public func encode(into commandEncoder: inout RESPCommandEncoder) {
        commandEncoder.encodeArray("PFSELFTEST")
    }
}

extension ValkeyConnection {
    /// Adds elements to a HyperLogLog key. Creates the key if it doesn't exist.
    ///
    /// - Documentation: [PFADD](https:/valkey.io/commands/pfadd)
    /// - Version: 2.8.9
    /// - Complexity: O(1) to add every element.
    /// - Categories: @write, @hyperloglog, @fast
    /// - Returns: One of the following:
    ///     * [Integer](https:/valkey.io/topics/protocol/#integers): `1` if at least one HyperLogLog internal register was altered.
    ///     * [Integer](https:/valkey.io/topics/protocol/#integers): `0` if no HyperLogLog internal registers were altered.
    @inlinable
    public func pfadd(key: RESPKey, element: [String] = []) async throws -> Int {
        try await send(command: PFADD(key: key, element: element))
    }

    /// Returns the approximated cardinality of the set(s) observed by the HyperLogLog key(s).
    ///
    /// - Documentation: [PFCOUNT](https:/valkey.io/commands/pfcount)
    /// - Version: 2.8.9
    /// - Complexity: O(1) with a very small average constant time when called with a single key. O(N) with N being the number of keys, and much bigger constant times, when called with multiple keys.
    /// - Categories: @read, @hyperloglog, @slow
    /// - Returns: [Integer](https:/valkey.io/topics/protocol/#integers): the approximated number of unique elements observed via `PFADD`.
    @inlinable
    public func pfcount(key: [RESPKey]) async throws -> Int {
        try await send(command: PFCOUNT(key: key))
    }

    /// Merges one or more HyperLogLog values into a single key.
    ///
    /// - Documentation: [PFMERGE](https:/valkey.io/commands/pfmerge)
    /// - Version: 2.8.9
    /// - Complexity: O(N) to merge N HyperLogLogs, but with high constant times.
    /// - Categories: @write, @hyperloglog, @slow
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func pfmerge(destkey: RESPKey, sourcekey: [RESPKey] = []) async throws {
        _ = try await send(command: PFMERGE(destkey: destkey, sourcekey: sourcekey))
    }

    /// An internal command for testing HyperLogLog values.
    ///
    /// - Documentation: [PFSELFTEST](https:/valkey.io/commands/pfselftest)
    /// - Version: 2.8.9
    /// - Complexity: N/A
    /// - Categories: @hyperloglog, @admin, @slow, @dangerous
    /// - Returns: [Simple string](https:/valkey.io/topics/protocol/#simple-strings): `OK`.
    @inlinable
    public func pfselftest() async throws {
        _ = try await send(command: PFSELFTEST())
    }

}
